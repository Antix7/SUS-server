<!DOCTYPE html>
<html lang="pl-PL">
<head>
    <meta charset="UTF-8">
    <title>Wyświetlanie sprzętu</title>

    <style>
        #outer > * {
            display: inline-block;
            border-right-style: solid;
        }
        th, td {
            border: 1px solid black;
            padding: 3px;
        }
        #delete {
            position: fixed;
            right: 0;
            top:0;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script>
        $(document).ready(function(){

            $.get(
                "/sprzet_panel/wyswietl/filters",
                function(data, status) {
                    $("#kategoria").html(data.kategoria);
                    $("#stan").html(data.stan);
                    $("#lokalizacja").html(data.lokalizacja);
                    $("#status").html(data.status);
                    $("#wlasciciel").html(data.wlasciciel);
                    $("#uzytkownik").html(data.uzytkownik);

                    // this has to be executed after the get request is completed,
                    // otherwise #kategoria_form does not exist yet
                    $("#kategoria_form").change(function() { // async?
                        $.post(
                            "/sprzet_panel/wyswietl/filters/stany",
                            {kategoria: $("#kategoria_form").serializeArray()},
                            function (data, status) {
                                $("#stan").html(data);
                            }
                        );
                    });
                });




            $("#submit_btn").click(function() {
                let form_data = {
                    kategoria: $("#kategoria_form").serializeArray(),
                    stan: $("#stan_form").serializeArray(),
                    lokalizacja: $("#lokalizacja_form").serializeArray(),
                    status: $("#status_form").serializeArray(),
                    nazwa: $("#nazwa_form").serializeArray(),
                    wlasciciel: $("#wlasciciel_form").serializeArray(),
                    uzytkownik: $("#uzytkownik_form").serializeArray()
                };
                $.post(
                    "/sprzet_panel/wyswietl/auth",
                    form_data,
                    function (data, status) {
                        $("#sprzet_div").html(data);

                        $('.edytuj').submit(function(e) {
                            e.preventDefault();
                            let myID = $(this).attr("id");
                            myID = myID.substring(myID.indexOf('-') + 1);
                            location.href = `/sprzet_panel/edytuj?id=${myID}`;
                        });
                    }
                );
            });

            $('#delete').submit(function(e) {
                e.preventDefault();
                let toDelete = [];
                $('.selectRow').each(function() {
                    if(this.checked)
                        toDelete.push($(this).val());
                });
                if(toDelete.length === 0)
                    return 0;
                $.post(
                    "/sprzet_panel/wyswietl/usun",
                    {'toDelete': toDelete},
                    function(data, status) {
                        $('.selectRow').each(function() {
                            if(this.checked) {
                                $(this).parent().parent().remove();
                            }
                        });
                    }
                )
            });
        });


    </script>

</head>
<body>

<form id="delete">
    <input type="submit" value="usuń">
</form>

<form action="/sprzet_panel" method="get">
    <input type="submit" value="Wróć">
</form>


<div id="outer">

    <div id="kategoria"></div>
    <div id="stan">Wybierz kategorię</div>
    <div id="lokalizacja"></div>
    <div id="status"></div>
    <div id="nazwa">
        <form id="nazwa_form">
            <input type="text" name="nazwa" placeholder="Nazwa">
        </form>
    </div>
    <div id="wlasciciel"></div>
    <div id="uzytkownik"></div>

</div>

<button id="submit_btn">Wyświetl sprzęt</button>

<div id="sprzet_div"></div>

</body>
</html>