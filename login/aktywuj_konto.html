<!DOCTYPE html>
<html lang="pl-PL">
<head>

    <meta charset="UTF-8">
    <title>Zakładanie konta</title>
</head>
<body>
<form id="form">
    <input required type="text" placeholder="Klucz dostępu" name="key"><br>
    <input required type="text" placeholder="Nowa nazwa użytkownika" name="username"><br>
    <input required type="password" placeholder="Nowe hasło" id="password1" name="password1"><br>
    <input required type="password" placeholder="Powtórz nowe hasło" id="password2" name="password2"><br>
    <input type="email" placeholder="Adres e-mail" id="email_input" name="email">
    <label for="email_input">Opcjonalny w celu odzyskiwania konta</label><br>
    <span id="match"></span><br>
    <input type="submit" id="submit_btn" value="Utwórz konto"><br>
</form>

<p id="status"></p>

<!--<form action="/" method="get">
    <input type="submit" value="Wróć">
</form>-->
<button onclick="history.back()">Wróć</button>

<script>

    const form = document.getElementById("form");
    const password1 = document.getElementById("password1");
    const password2 = document.getElementById("password2");
    const match = document.getElementById("match");
    const status = document.getElementById("status");

    form.addEventListener("submit", (e) => {
        e.preventDefault();

        if(password1.value !== password2.value) {
            match.innerText = "Hasła nie są takie same";
            match.style.color = "red";
            return;
        }

        fetch("/aktywuj_konto/auth", {
            method: "POST",
            body: new FormData(form)
        })
            .then(response => response.json())
            .then(data => {
                status.innerText = data.message;
            })
            .catch(error => {
                status.innerText = "Nastąpił błąd, spróbuj ponownie później.";
            })
    });

</script>
</body>
</html>